# Step 04 — Distributed Lag Construction for Panel Data

## Overview

This script constructs a **distributed-lag panel dataset** from interleaved Call Report files by merging each bank’s current-quarter data with their values from the **next 3 quarters**. The result is a horizontally stacked DataFrame per bank-quarter, enabling analysis of forward changes and risk trajectory.

These are saved as `Distributed_Call_Report_YYYYMMDD.csv` and form the base panel for Jensen-Shannon divergence modeling and other temporal diagnostics.

---

## Input Requirements

- **`quarters.csv`**  
  A list of quarterly reporting dates in `YYYYMMDD` format, sorted ascending.
  `/Call Report/CSV/quarters.csv`
  
- **Interleaved Call Reports**  
Generated by Step 03, these must exist and be named as:
  - `/Call Report/CSV/Interleaved/Cleaned_Call_Report_<YYYYMMDD>.csv`

---

## Output

- **Directory**:  
`/Call Report/CSV/Distributed_Lag/RAW/`


- **Files**:  
`Distributed_Cleaned_Call_Report_<YYYYMMDD>.csv`


Each file includes:
- All bank rows for a given quarter
- Horizontally merged values from the **next 3 quarters**
- Columns renamed with suffixes indicating the forward lag quarter (`_<YYYYMMDD>`)

---

## Processing Logic

1. The script loads each date from `quarters.csv`, excluding the last three to avoid index overrun.
2. For each date:
 - Loads the interleaved base file
 - Looks ahead 3 quarters and merges their data on `CERT` (FDIC Certificate Number)
 - Appends the forward-looking ratios as lagged columns with suffixes
3. The merged result is saved to `/Distributed_Lag/RAW/`

---

## Use Case

These horizontally stacked, multi-quarter records allow:
- **Forward-looking divergence measurement**
- **Time series slope modeling per bank**
- **Lag-based correlation analysis**
- **Alignment of financial distress trajectories**

They feed directly into:
- Step 04.1: ``Clean_Distributed_Ratios2.py``


